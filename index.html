<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Game Nhay Lau</title>
    <style>
        *{
            box-sizing: border-box;
            padding:0px;
        }
        .MainBox {
            line-height: 0;
            width:800px;
            height:600px;
            margin: 0 auto;
            background-color: black;
        }
         canvas{
            height:600px;
            width:800px;
            position: absolute;
        }
        #Mainlayer{
            z-index: 1;
        } 
        #BackgroundLayer{
            z-index: 0;
        } 
    </style>
</head>
<body>
    <div class="MainBox">
        <canvas id="Mainlayer"></canvas>
        <canvas id="BackgroundLayer"></canvas>
        <canvas id="bulletLayer"></canvas>
   

    </div>
    <script src="background.js"></script>
    <!-- <script src="Object.js"></script> -->
    
    <script>
    //ve con chim
    let Mainlayer = document.getElementById('Mainlayer'); 
    let ctxMain = Mainlayer.getContext('2d'); 
    function ImageObj(){
        this.bird=new Image();
        this.bullet= new Image();
        this.bird.src = "bird.png";
        this.bullet.src = "crow.png";
    }
    ImageObj.prototype.init=function(x, y, width, height){
            this.x = x;
            this.y = y;
            this.width = width;
            this.height = height;
    }   
    let bird= new ImageObj();
    let YJump=0;
    let Jumping=false;
    let Dropping=true;
    let speed=1;
    let speedcount=1;
    bird.init(100,100,800,600)
    
    function dead(){
        ctxMain.drawImage(bird.bird,bird.x,bird.y)
    } 

    function jump(){
        ctxMain.clearRect(0, 0, 800, 600)
        if(Dropping==false){
        ctxMain.drawImage(bird.bird,bird.x,bird.y-=1)
        console.log("jump")
        }
        if(bird.y<YJump-30){
            Dropping=true;
            console.log("chuyen sang drop")
            drop()
            return;
        }
        window.requestAnimationFrame(jump);
       
    }
    function drop(){
        if(bird.y<110){
        //se thay the chuc nang kiem tra co cham mat dat khong sau
            if(Dropping==true){
                ctxMain.clearRect(0, 0, 800, 600)
                ctxMain.drawImage(bird.bird,bird.x,bird.y+=1)
            }
            else {
                return;
            }
        }
        else{
            window.requestAnimationFrame(dead)
        }
        console.log("drop" +Dropping+" bird "+bird.y)
        window.requestAnimationFrame(drop);
    }
    function whenPressSpace(nhay){
        YJump=bird.y;
        if(Dropping==true){
        Dropping=false;
        speed++;
        jump();
        }   
    }
   
    // Ve vien dan
    function randomInteger(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
    }
    let BulletLayer = document.getElementById('bulletLayer'); 
    let ctxBullet = BulletLayer.getContext('2d'); 
    let Bullet=new ImageObj();
    let Bullet2=new ImageObj();
    let Bullet3=new ImageObj();
    Bullet.init(290,30,800,600);
    Bullet2.init(290,60,800,600);
    Bullet3.init(290,90,800,600);
    function movingBullet(){
        ctxBullet.clearRect(0, 0, 800, 600)
        ctxBullet.drawImage(Bullet.bullet,Bullet.x-=3,Bullet.y)
        ctxBullet.drawImage(Bullet2.bullet,Bullet2.x-=4,Bullet2.y)
        ctxBullet.drawImage(Bullet3.bullet,Bullet3.x-=5,Bullet3.y)
        console.log("1")
        if(Bullet.x==-25){
            Bullet.x=290;
            Bullet.y=randomInteger(0,30);
           
        }
        if(Bullet2.x==-30){
            Bullet2.x=290;
            Bullet2.y=randomInteger(30,60);
        }
        if(Bullet3.x==-70){
            Bullet3.x=290;
            Bullet3.y=randomInteger(60,90);
        }
        window.requestAnimationFrame(movingBullet);

    } 
    movingBullet();
    let nhay = window.addEventListener("keypress",whenPressSpace);  //chim nhay
    </script>
</body>
</html>