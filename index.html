<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Game Nhay Lau</title>
    <style>
        *{
            box-sizing: border-box;
            padding:0px;
        }
        .MainBox {
            line-height: 0;
            width:800px;
            height:600px;
            margin: 0 auto;
            background-color: black;
        }
         canvas{
            height:600px;
            width:800px;
            position: absolute;
        }
        #Mainlayer{
            z-index: 1;
        } 
        #BackgroundLayer{
            z-index: 0;
        } 
    </style>
</head>
<body>
    <div class="MainBox">
        <canvas id="Mainlayer"></canvas>
        <canvas id="BackgroundLayer"></canvas>
        <canvas id="bulletLayer"></canvas>
   

    </div>
    <script src="background.js"></script>
    <!-- <script src="Object.js"></script> -->
    
    <script>
    //ve con chim
    let count=-1;
 
    let Mainlayer = document.getElementById('Mainlayer'); 
    let ctxMain = Mainlayer.getContext('2d'); 
    let BulletLayer = document.getElementById('bulletLayer'); 
    let ctxBullet = BulletLayer.getContext('2d'); 
    

    function ImageObj(){
        this.bird=new Image();
        this.bullet= new Image();
        this.bird.src = "bird.png";
        this.bullet.src = "arrow.png";
        this.self=this;

        this.getBird=function(){
            return this.bird;
        }
    }
    
    ImageObj.prototype.init=function(x, y, width, height,layer,Dropping){
        this.x = x;
        this.y = y;
        this.width = width;
        this.height = height;
        this.layer=layer;
        this.Dropping=Dropping
        this.ToaDo=[this.x,this.y];
    }

    ImageObj.prototype.jump=function(self){
        self.layer.clearRect(0, 0, 800, 600)
        if(self.Dropping==false){
        self.layer.drawImage(self.bird,self.x,self.y-=1)
        self.ToaDo=[self.x,self.y];
        }
        if(self.y<self.ToaDoNhay-30){
            Dropping=true;
            self.drop(self);
            return;
        }
        window.requestAnimationFrame(function() {self.jump(self)});
    } 
    
    ImageObj.prototype.movingBullet=function(self,num1,num2,num4,num5){
        self.layer.drawImage(self.bullet,self.x-=num1,self.y)
        console.log(self.x)
        self.ToaDo[0]=self.x;
        self.ToaDo[1]=self.y;
        if(self.x<num2){
            self.x=290;
            self.y=randomInteger(num4,num5);   
        }
    }

    ImageObj.prototype.checkCollide=function (char,a){
        
    }

    ImageObj.prototype.whenPressSpace=function(){
        this.ToaDoNhay=this.y;
        if(this.Dropping==true){
            this.Dropping=false;
        jump();
        }   
    }

    // window.addEventListener("keypress",bwhenPressSpace());
    function randomInteger(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    ImageObj.prototype.drop=function(self){
        if(self.y<110){
        //se thay the chuc nang kiem tra co cham mat dat khong sau
            if(self.Dropping==true){
                self.layer.clearRect(0,0,800,600)
                self.layer.drawImage(self.bird,self.x,self.y+=1)
            }
            else {
                return;
            }
            self.ToaDo=[self.x,self.y];
        }
        window.requestAnimationFrame(function() {self.drop(self)})
    }



    function BulletRain(self1,self2,self3,char){
        self1.layer.clearRect(0, 0, 800, 600)
        self1.movingBullet(self1,5,-10,0,30)
        self2.movingBullet(self2,6,-90,40,60)
        self3.movingBullet(self3,8,-10,60,100)
        self1.checkCollide(char,self1);
        self2.checkCollide(char,self2);
        self3.checkCollide(char,self3);
        window.requestAnimationFrame(function() {BulletRain(self1,self2,self3)});
    }
    
    let Bullet=new ImageObj();
    let Bullet2=new ImageObj();
    let Bullet3=new ImageObj();
    let bird= new ImageObj();

    bird.init(0,5,800,600,ctxMain,true);
    Bullet.init(0,5,800,600,ctxBullet,true);
    Bullet2.init(0,50,800,600,ctxBullet,true);
    Bullet3.init(0,80,800,600,ctxBullet,true);

    bird.drop(bird);
    BulletRain(Bullet,Bullet2,Bullet3,bird);


    </script>
</body>
</html>
