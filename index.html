<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Game Nhay Lau</title>
    <style>
        *{
            box-sizing: border-box;
            padding:0px;
        }
        .MainBox {
            line-height: 0;
            width:800px;
            height:600px;
            margin: 0 auto;
            background-color: black;
        }
         canvas{
            height:600px;
            width:800px;
            position: absolute;
        }
        #Mainlayer{
            z-index: 1;
        } 
        #BackgroundLayer{
            z-index: 0;
        } 
    </style>
</head>
<body>
    <div class="MainBox">
        <canvas id="Mainlayer"></canvas>
        <canvas id="BackgroundLayer"></canvas>
        <canvas id="bulletLayer"></canvas>
   

    </div>
    <script src="background.js"></script>
    <!-- <script src="Object.js"></script> -->
    
    <script>
    //ve con chim
    let Mainlayer = document.getElementById('Mainlayer'); 
    let ctxMain = Mainlayer.getContext('2d'); 
    function ImageObj(){
        this.bird=new Image();
        this.bullet= new Image();
        this.bird.src = "bird.png";
        this.bullet.src = "arrow.png";
    }
    ImageObj.prototype.init=function(x, y, width, height){
            this.x = x;
            this.y = y;
            this.width = width;
            this.height = height;
            this.ToaDo=[this.x,this.y];
    }   
    let bird= new ImageObj();
    let YJump=0;
    let Jumping=false;
    let Dropping=true;
    let speed=1;
    let speedcount=1;
    bird.init(100,100,800,600)

    function jump(){
        ctxMain.clearRect(0, 0, 800, 600)
        if(Dropping==false){
        ctxMain.drawImage(bird.bird,bird.x,bird.y-=1)
        bird.ToaDo=[bird.x,bird.y];
        }
        if(bird.y<YJump-30){
            Dropping=true;
            drop()
            return;
        }
        window.requestAnimationFrame(jump);
       
    }
    function drop(){
        if(bird.y<110){
        //se thay the chuc nang kiem tra co cham mat dat khong sau
            if(Dropping==true){
                ctxMain.clearRect(0, 0, 800, 600)
                ctxMain.drawImage(bird.bird,bird.x,bird.y+=1)
            }
            else {
                return;
            }
            bird.ToaDo=[bird.x,bird.y];
        }
        else{
            window.requestAnimationFrame(dead)
        }
        window.requestAnimationFrame(drop);
    }
    function whenPressSpace(nhay){
        YJump=bird.y;
        if(Dropping==true){
        Dropping=false;
        speed++;
        jump();
        }   
    }
   
    // Ve vien dan
    function randomInteger(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
    }
    let BulletLayer = document.getElementById('bulletLayer'); 
    let ctxBullet = BulletLayer.getContext('2d'); 
    let Bullet=new ImageObj();
    let Bullet2=new ImageObj();
    let Bullet3=new ImageObj();
    Bullet.init(290,30,800,600);
    Bullet2.init(290,60,800,600);
    Bullet3.init(290,90,800,600);  
    function movingBullet(){
        ctxBullet.clearRect(0, 0, 800, 600)
        ctxBullet.drawImage(Bullet.bullet,Bullet.x-=6,Bullet.y)
        Bullet.ToaDo[0]=Bullet.x;
        Bullet.ToaDo[1]=Bullet.y;
        ctxBullet.drawImage(Bullet2.bullet,Bullet2.x-=5,Bullet2.y)
        Bullet2.ToaDo[0]=Bullet2.x;
        Bullet2.ToaDo[1]=Bullet2.y;
        ctxBullet.drawImage(Bullet3.bullet,Bullet3.x-=7,Bullet3.y)
        Bullet3.ToaDo[0]=Bullet3.x;
        Bullet3.ToaDo[1]=Bullet3.y;
        checkCollide(bird.ToaDo,Bullet.ToaDo,Bullet2.ToaDo,Bullet3.ToaDo);
        if(Bullet.x==-70){
            Bullet.x=290;
            Bullet.y=randomInteger(0,30);
           
        }
        if(Bullet2.x==-30){
            Bullet2.x=290;
            Bullet2.y=randomInteger(30,60);
        }
        if(Bullet3.x==-60){
            Bullet3.x=290;
            Bullet3.y=randomInteger(60,90);
        }
        window.requestAnimationFrame(movingBullet);

    } 
    function checkCollide(char,a1,a2,a3){
        if((char[0]+5<=a1[0]+10)&&(char[0]-5>=a1[0]-10)&&(char[1]>=a1[1]-2)&&(char[1]<=a1[1]+2)){
            alert("you are dead")
            console.log("arrow1 "+a1+" Bird "+char)
        }
        if((char[0]+5<=a2[0]+10)&&(char[0]-5>=a2[0]-10)&&(char[1]>=a2[1]-2)&&(char[1]<=a2[1]+2)){
            alert("you are dead")
            console.log("arrow2 "+a2+" Bird "+char)
        }
        if((char[0]+5<=a3[0]+10)&&(char[0]-5>=a3[0]-10)&&(char[1]>=a3[1]-2)&&(char[1]<=a3[1]+2)){
            alert("you are dead")
            console.log("arrow3 "+a3+" Bird "+char)
        }
    }
    movingBullet();
    let nhay = window.addEventListener("keypress",whenPressSpace);  //chim nhay
    </script>
</body>
</html>